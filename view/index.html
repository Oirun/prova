<!DOCTYPE html>
<html>

<head>
    <title>Quiz</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link rel="stylesheet" href="css/css.css">

    <script src="js/funcoes.js"></script>
</head>

<body style="background: #212529;">
    <nav class="navbar bg-body-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img alt="Logo" width="50" height="50" class="d-inline-block align-text-top" src="/images/quiz.webp"
                    alt="">
            </a>
            <button class="btn btn-primary btn-lg px-4 gap-3 mt-3" id="sair" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Sair." type="button"><i
                    class="bi bi-box-arrow-right"></i></button>
        </div>
    </nav>

    <div class="px-4 pt-3 mt-3 text-center">
        <h1 class="display-5 fw-bold text-body-emphasis" id="tituloQuiz">Bem vindo ao Quiz Manu</h1>
        <div class="col-lg-6 mx-auto">
            <p class="lead mb-4" id="paragrafo-instrucao">Esse é um quiz para saber o seu conhecimento nos jogos de
                Coral Island e Stardew Valley, tenha uma boa jogatina.</p>
            <div class="d-grid gap-2 d-sm-flex justify-content-sm-center">
                <form id="form-bem-vindo">
                    <div>
                        <label for="nome" id="nome-label">Informe o seu nome para começar a jogar</label>
                        <input type="text" class="form-control" id="nome" maxlength="10">
                    </div>
                    <div>
                        <button class="btn btn-primary btn-lg px-4 gap-3 mt-3" id="nome-enviar" type="button" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Entrar."><i class="bi bi-send"></i></button>
                    </div>
                </form>
            </div>
            <label class="label-control mb-3" id="user"></label>
        </div>
    </div>

    <div class="container row g-3 d-none" id="pontuacoes">
        <div class="col-10">
            <span id="pontuacaoNome">Pontuação -</span>
            <div>
                <span id="circuloDoJogador" class="d-inline-block bg-success rounded-circle p-1"></span>
                <span id="pontuacaoDoJogadoreCerta">Certas - 0</span>
                <span id="pontuacaoDoJogadoreErrada">Erradas - 0</span>
            </div>
        </div>
        <div class="col-2">
            <div class="cronometro">
                <span id="horas">00</span><span class="doisPontos">:</span><span id="minuto">00</span><span
                    class="doisPontos">:</span><span id="segundo">00</span>
            </div>
        </div>

    </div>

    <div class="container box-chat" id="chat-box" style="display: none;">

        <div class="container box-chat-ul">
            <h4 class="titulo-pergunta mb-5">Pergunta</h4>
            <div id="messages">
                <button type="button" id="pronto" class="btn btn-outline-primary btn-lg comecar" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Clique para começar a jogar.">Começar</button>
            </div>
        </div>
    </div>

    <button type="button" class="btn btn-primary d-none" id="abrir-pontuacao" data-bs-toggle="modal"
        data-bs-target="#modal-pontuacao-final">
        Abrir Modal
    </button>


    <div class="modal fade" id="modal-pontuacao-final" tabindex="-1" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Pontuação Final</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-6">
                            <div class="row g-3">
                                <div class="col-1">
                                    <i class="bi bi-check2-square check-modal"></i>
                                </div>
                                <div class="col-10">
                                    <h3>Perguntas Acertadas</h3>
                                </div>
                            </div>
                            <input type="checkbox" id="pergunta_1" class="form-check-input radio-pergunta me-3 ms-1"
                                disabled>
                            <input type="checkbox" id="pergunta_2" class="form-check-input radio-pergunta me-3"
                                disabled>
                            <input type="checkbox" id="pergunta_3" class="form-check-input radio-pergunta me-3"
                                disabled>
                            <input type="checkbox" id="pergunta_4" class="form-check-input radio-pergunta me-3"
                                disabled>
                            <input type="checkbox" id="pergunta_5" class="form-check-input radio-pergunta me-3"
                                disabled>
                            <input type="checkbox" id="pergunta_6" class="form-check-input radio-pergunta me-3"
                                disabled>
                            <input type="checkbox" id="pergunta_7" class="form-check-input radio-pergunta me-3"
                                disabled>
                            <input type="checkbox" id="pergunta_8" class="form-check-input radio-pergunta me-3"
                                disabled>
                            <input type="checkbox" id="pergunta_9" class="form-check-input radio-pergunta me-3"
                                disabled>
                            <input type="checkbox" id="pergunta_10" class="form-check-input radio-pergunta me-3"
                                disabled>

                            <img src="images/Enthusiastic-cuate.png" class="imageParabens" alt="">
                        </div>
                        <div class="col-6 separador">
                            <div class="row g-3">
                                <div class="col-1">
                                    <i class="bi bi-list-ol check-modal"></i>
                                </div>
                                <div class="col-10">
                                    <h3>Rank</h3>
                                </div>
                            </div>
                            <ul class="list-group list-group-numbered" id="lista-de-rank">
                            </ul>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

    <script>

        var socket = io();

        var messages = document.getElementById('messages');
        var form = document.getElementById('form');
        var input = document.getElementById('nome');

        document.getElementById("sair").onclick = function () {
            window.location.reload()
        }

        // conectando ao servidor
        document.getElementById("nome-enviar").onclick = function () {
            if (document.getElementById("nome").value.trim() == "") {
                Swal.fire({
                    title: "Nome Vazio NUM PODE",
                    text: "Campo nome vazio, preencha para começar a jogar",
                    icon: "error"
                })
            } else {
                socket.emit('conectado', document.getElementById("nome").value)
            }
        }

        document.getElementById("nome-enviar").addEventListener('submit', function (e) {
            e.preventDefault();
            if (input.value) {
                socket.emit('chat message', input.value);
                input.value = '';
            }
        });

        socket.on('chat message', function (msg) {
            document.getElementById("user").innerText = "Novo usuário conectado"
            var item = document.createElement('li');
            item.textContent = msg;
            messages.appendChild(item);
            window.scrollTo(0, document.body.scrollHeight);
        });

        socket.on('conectado', function (nome) {
            document.getElementById("user").innerText = "Bem vindo(a) " + document.getElementById("nome").value
            document.getElementById("user").setAttribute("data-nome", document.getElementById("nome").value)
            document.getElementById("tituloQuiz").innerText = "Quiz da Manu"
            document.getElementById("paragrafo-instrucao").innerText = "Clique em começar, e depois é só ler e clicar na resposta para ser certa."
            setTimeout(() => {
                document.getElementById("user").innerText = "Jogador(a) " + document.getElementById("nome").value + " online"
            }, 2000);
            document.getElementById("chat-box").style.display = "block"
            document.getElementById("form-bem-vindo").style.display = "none"


        })

        // funcao para o cronometro
        let segundos = 0;
        let minutos = 0;

        function segundo() {
            segundos++;
            if (segundos == 60) {
                minutos++;
                segundos = 0;
                document.getElementById('minuto').innerHTML = minutos
            }
            document.getElementById('segundo').innerHTML = segundos
        }
        var intervalo
        function pararContagem() {
            segundos = 0
            minutos = 0
            clearInterval(intervalo)
        }

        var cores = ["success", "primary", "danger", "warning"]
        let cor
        // Verificando cores

        document.getElementById("pronto").onclick = async function () {
            perguntasFeitas = 0
            respostasCertas = 0
            respostasErradas = 0
            perguntasAcertadas = []
            //------------ zerando componentes para um novo jogo
            document.getElementById("pontuacaoDoJogadoreCerta").innerHTML = "Certas - 0"
            document.getElementById("pontuacaoDoJogadoreErrada").innerHTML = "Erradas - 0"
            document.getElementById("horas").innerHTML = "00"
            document.getElementById("minuto").innerHTML = "00"
            document.getElementById("segundo").innerHTML = "00"

            //-------------- iniciando contagem
            intervalo = setInterval(function () { segundo() }, 1000)

            //---------- pegando a cor para o jogador
            let cont = 0
            await fetch("/data")
                .then(response => response.json())
                .then(data => {

                    if (data.length == 0) {
                        cor = cores[cont]
                    } else {
                        data.forEach(element => {
                            if (element.cor == cores[cont]) {
                                cont++
                            } else {
                                cor = cores[cont]
                            }
                        });
                    }
                })

            //------------ adicionando um novo jogador ao json jogadores
            let obj = {
                "nome": document.getElementById("user").dataset.nome,
                "cor": cores[cont],
                "acertos": 0,
                "tempo": 0
            }

            //------------- criando pontuacao com a requuisicao para o servidor
            await fetch('/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(obj),
            })
                .then(response => response.text())
                .then(data => {
                    document.getElementById("pontuacoes").classList.remove("d-none")
                    document.getElementById("circuloDoJogador").classList.remove("bg-success")
                    document.getElementById("circuloDoJogador").classList.add("bg-" + obj.cor)
                    document.getElementById('pontuacaoNome').innerText = "Pontuação - " + obj.nome;
                    document.getElementById("pronto").classList.add("d-none")
                    mostrarCard()
                })
                .catch(error => {
                    console.error('Erro:', error);
                });
        }

    </script>
    <script>
        const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
        const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    </script>

</body>

</html>