<!DOCTYPE html>
<html>

<head>
    <title>Quiz</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link rel="stylesheet" href="css/css.css">

    <script src="js/funcoes.js"></script>
</head>

<body>

    <div class="px-4 pt-5 mt-5 text-center">
        <img class="d-block mx-auto mb-4" id="imgQuiz" src="/images/quiz.webp" alt="">
        <h1 class="display-5 fw-bold text-body-emphasis" id="tituloQuiz">Bem vindo ao Quiz Manu</h1>
        <div class="col-lg-6 mx-auto">
            <p class="lead mb-4" id="paragrafo-instrucao">Esse é um quiz para saber o seu conhecimento nos jogos de
                Coral Island e Stardew Valley, tenha uma boa jogatina.</p>
            <div class="d-grid gap-2 d-sm-flex justify-content-sm-center">
                <form id="form-bem-vindo">
                    <div>
                        <label for="nome">Informe o seu nome para começar a jogar</label>
                        <input type="text" class="form-control" id="nome">
                    </div>
                    <div>
                        <button class="btn btn-primary btn-lg px-4 gap-3 mt-3" id="nome-enviar" type="button"><i
                                class="bi bi-send"></i></button>
                    </div>
                </form>
            </div>
            <label class="label-control mb-3" id="user"></label>
        </div>
    </div>

    <div class="container d-none" id="pontuacoes">
        <span id="pontuacaoNome">Pontuação -</span>
        <div>
            <span id="circuloDoJogador" class="d-inline-block bg-success rounded-circle p-1"></span>
            <span id="pontuacaoDoJogadoreCerta">0</span>
            <span id="pontuacaoDoJogadoreErrada">0</span>
        </div>
    </div>

    <div class="container box-chat" id="chat-box" style="display: none;">

        <div class="container box-chat-ul">
            <h4 class="titulo-pergunta mb-5">Pergunta</h4>
            <div id="messages">
                <button type="button" id="pronto" class="btn btn-outline-primary btn-lg comecar">Começar</button>
                <button type="button" id="sair" class="btn btn-outline-primary btn-lg comecar d-none">Desconectar</button>
            </div>
        </div>

        <!-- <form id="form" action="">
            <input id="input" autocomplete="off" /><button>Enviar</button>
        </form> -->
    </div>


    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

    <script>
        var socket = io();

        var messages = document.getElementById('messages');
        var form = document.getElementById('form');
        var input = document.getElementById('nome');

        document.getElementById("sair").onclick = async function () {
            Swal.fire({
                    title: "Saindo",
                    text: "Obrigada por participar do jogo, qualquer coisa é só voltar!",
                    icon: "info"
                })
                await fetch('/sair')
                .then(response => response.text())
                .then(data => {
                    console.log(data)
                })
                .catch(error => {
                    console.error('Erro:', error);
                });
        }

        document.getElementById("nome-enviar").onclick = function () {
            if (document.getElementById("nome").value == "") {
                Swal.fire({
                    title: "Nome Vazio NUM PODE",
                    text: "Campo nome vazio, preencha para começar a jogar",
                    icon: "error"
                })
            } else {
                socket.emit('conectado', document.getElementById("nome").value)
            }

        }

        document.getElementById("nome-enviar").addEventListener('submit', function (e) {
            e.preventDefault();
            if (input.value) {
                socket.emit('chat message', input.value);
                input.value = '';
            }
        });

        socket.on('chat message', function (msg) {
            document.getElementById("user").innerText = "Novo usuário conectado"
            var item = document.createElement('li');
            item.textContent = msg;
            messages.appendChild(item);
            window.scrollTo(0, document.body.scrollHeight);
        });

        socket.on('conectado', function (nome) {
            document.getElementById("user").innerText = "Bem vindo(a) " + document.getElementById("nome").value
            document.getElementById("user").setAttribute("data-nome", document.getElementById("nome").value)
            document.getElementById("tituloQuiz").innerText = "Quiz da Manu"
            document.getElementById("paragrafo-instrucao").innerText = "Clique em começar, e depois é só ler e clicar na resposta para ser certa."
            setTimeout(() => {
                document.getElementById("user").innerText = "Jogador(a) " + document.getElementById("nome").value + " online"
            }, 2000);
            document.getElementById("chat-box").style.display = "block"
            document.getElementById("form-bem-vindo").style.display = "none"


        })

        var cores = ["success", "primary", "danger", "warning"]
        let cor
        // Verificando cores
        document.getElementById("pronto").onclick = async function () {
            let cont = 0
            await fetch("/data")
                .then(response => response.json())
                .then(data => {

                    if (data.length == 0) {
                        cor = cores[cont]
                    } else {
                        data.forEach(element => {
                            if (element.cor == cores[cont]) {
                                cont++
                            } else {
                                cor = cores[cont]
                            }
                        });
                    }
                })

            let obj = {
                "nome": document.getElementById("user").dataset.nome,
                "cor": cores[cont]
            }
            //criando pontuacao
            await fetch('/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(obj),
            })
                .then(response => response.text())
                .then(data => {
                    document.getElementById("pontuacoes").classList.remove("d-none")
                    document.getElementById("circuloDoJogador").classList.remove("bg-success")
                    document.getElementById("circuloDoJogador").classList.add("bg-" + obj.cor)
                    document.getElementById('pontuacaoNome').innerText = "Pontuação - " + obj.nome;
                    document.getElementById("pronto").remove()
                    mostrarCard()
                })
                .catch(error => {
                    console.error('Erro:', error);
                });
        }


        
    </script>


</body>

</html>